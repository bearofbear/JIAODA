<div class="easyui-layout" data-options="fit:true">
  
    <div data-options="region:'center',border:false">
      <!-- Begin of toolbar -->
        <div id="wu-materbar">
            <div class="wu-toolbar-button">
                <a href="#" class="easyui-linkbutton" iconCls="icon-add" onclick="materopenAdd()" plain="true">出库新增</a>
                <a href="#" class="easyui-linkbutton" iconCls="icon-tip" onclick="materopenEdit()" plain="true">出库审核</a>
                <a href="#" class="easyui-linkbutton" iconCls="icon-find" onclick="$('#wu-checkmater').window('open')" plain="true">库存查看</a>
                
            </div>

            <!-- 搜索筛选 -->
            <table width="100%" border="0" cellspacing="0" class="tablemain">
                 <tr>
                   <td width="11%">领料部门(*)：</td>
                   <td width="24%" height="37"><input class="easyui-searchbox" data-options="prompt:'Please Input Value'" style="width:270px" /></td>
                   <td width="9%">日期(*)：</td>
                   <td width="24%"><input id="lil" disabled="disabled" class="easyui-datebox"  style="width:270px"></td>
                   <td width="8%">编号(*)：</td>
                   <td width="24%"><input class="easyui-textbox" style="width:270px"></td>
                 </tr>
                 <tr>
                   <td>选单号：</td>
                   <td height="37">
             

<!--              <label><input class="easyui-searchbox" data-options="prompt:'Please Input Value'" style="width:270px"></label>
 -->            
                  <select class="easyui-combobox" name="materchoose" id="choosemater" style="width:200px;">
                      <option value="AL">商品1</option>
                      <option value="AK">商品2</option>
                      <option value="AZ">商品4</option>
                      <option value="AR">商品5</option>
                      <option value="CA">商品6</option>
                      <option value="CO">商品7</option>
                      <option value="CT">商品8</option>
                      <option value="DE">商品9</option>
                  </select>

            </td>
             <td></td>
             <td>
            

              </td>
             <td>&nbsp;</td>
             <td>
            <!--  <label>基本单位投入产量：</label>
             <input class="wu-text" style="width:270px" /> -->
             </td>
           </tr>
           <tr>
             <td></td>
             <td height="37" colspan="5">
              <a href="#" class="easyui-linkbutton" iconCls="icon-search" onclick="remove()" >查询</a>            

             <!-- <input class="wu-text" style="width:70%" /> --></td>
           </tr>
        
           


        </table> 


        
        </div>

      
        
        <!-- <div class="main-all">
          <span>合计</span>

        </div>   -->

        <!-- 搜索筛选 -->
       <!--  <table width="100%" border="0" cellspacing="0" class="tablemain">
           <tr>
             <td width="18%" height="37">
             <label class="searh-line">仓库保管员：</label>
              <input class="easyui-searchbox" data-options="prompt:'Please Input Value'" style="width:225px">
             </td>
             <td width="18%"><label class="searh-line">领用人：</label>
              <input class="easyui-searchbox" data-options="prompt:'Please Input Value'" style="width:225px"></td>
             <td width="18%">&nbsp;</td>
             <td width="18%">&nbsp;</td>
             <td width="18%">&nbsp;</td>
           </tr>
           <tr>
             
             <td><label class="searh-line" style="color:#ccc;">审核：</label>
             <input class="wu-text"  style="width:217px;color:#ccc" /></td>
      
             <td>&nbsp;</td>
           </tr>
           <tr>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
           </tr>
        </table>  -->
    </div>

    <table id="ll" class="easyui-datagrid" title="出库管理" data-options="method:'get',toolbar:'#wu-materbar'" style="height:500px;">  
    </table> 


</div>
<!-- 选单号过滤框 -->
<!--<div id="wg" class="easyui-window" title="选单号信息" data-options="iconCls:'icon-save',modal:true,closed:'true'" style="width:800px;height:500px;padding:5px;">
        <div class="easyui-layout" data-options="fit:true">
            <div data-options="region:'west',split:true" style="width:200px">
                <ul class="easyui-tree">
                    <li>
                        <span>产品信息</span>
                            <ul>
                                <li data-options="state:'closed'">
                                    <span>0001</span>
                                     <ul>
                                        <li>
                                            <span>Friend</span>
                                        </li>
                                        <li>
                                            <span>Wife</span>
                                        </li>
                                        <li>
                                            <span>Company</span>
                                        </li>
                                    </ul> 
                                </li>
                                <li>
                                    <span>002</span>
                                    <ul>
                                        <li>Intel</li>
                                        <li>Java</li>
                                        <li>Microsoft Office</li>
                                        <li>Games</li>
                                    </ul>
                                </li>
                                <li>index.html</li>
                                <li>about.html</li>
                                <li>welcome.html</li>
                            </ul>
                    </li>
                </ul>
            </div>

            <div data-options="region:'center'" style="padding:10px;">
                <table id="demo" class="easyui-datagrid" data-options="method:'get'" style="height:500px;">  
                </table> 
            </div>
            <div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
                <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)" onclick="javascript:alert('ok')" style="width:80px">Ok</a>
                <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" onclick="javascript:alert('cancel')" style="width:80px">Cancel</a>
            </div>
        </div>
</div>-->

<!-- 过滤对话框 -->
<!--<div id="w" class="easyui-window" title="过滤" data-options="closed:'true',modal:true" icon="icon-help" style="width:895px;height:550px;padding:5px;background: #fafafa;">
    <div class="easyui-layout" fit="true">

      <div region="west" split="true" style="width:220px;">
      <a href="#" class="easyui-linkbutton" iconCls="icon-save" onclick="reload()" plain="true">保存</a>
      <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="cancel()" plain="true">取消</a>
      <a href="#" class="easyui-linkbutton" iconCls="icon-edit" onclick="openEdit()" plain="true">修改</a>
        <ul class="easyui-tree">
          <li>
            <span>默认方案</span>
            <ul>
              <li><span>easyui</span></li>
              <li><span>Music</span></li>
              <li><span>Picture</span></li>
              <li><span>Database</span></li>
            </ul> 
          </li>
        </ul>
      </div>
      <div region="center" border="false" border="false">
        <div class="easyui-tabs" fit="true">
          <div title="条件" style="padding:10px;">
           <div style="margin-bottom:5px">
             <label>事务类型：</label> 
              <select class="easyui-combobox" panelHeight="auto" style="width:170px">
                  <option value="0">选择类型</option>
                  <option value="1">黄钻</option>
                  <option value="2">红钻</option>
                  <option value="3">蓝钻</option>
              </select>

              <input type="checkbox">单据头完整显示
              <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-add'">插入</a>
              <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">删除</a>
              <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-cancel'">全删</a>
           </div>
            <table id="sw" class="easyui-datagrid" data-options="method:'get'" style="height:250px;">  
            </table> 
            



			<div>
           	  <table width="100%" border="0" class="tablemain">
                  <tr>
                    <td width="46%" height="37"><label>时间：</label> 
              <select class="easyui-combobox" panelHeight="auto" style="width:170px">
                  <option value="0">本期</option>
                  <option value="1">黄钻</option>
                  <option value="2">红钻</option>
                  <option value="3">蓝钻</option>
              </select></td>
                    <td width="54%"><label>审核标志：</label>
                      <select name="select" class="easyui-combobox" style="width:170px" panelheight="auto">
                        <option value="0">本期</option>
                        <option value="1">黄钻</option>
                        <option value="2">红钻</option>
                        <option value="3">蓝钻</option>
                    </select></td>
                  </tr>
                  <tr>
                    <td height="37"><label>开票标志：</label>
                      <select name="select2" class="easyui-combobox" style="width:170px" panelheight="auto">
                        <option value="0">本期</option>
                        <option value="1">黄钻</option>
                        <option value="2">红钻</option>
                        <option value="3">蓝钻</option>
                    </select></td>
                    <td>&nbsp;</td>
                  </tr>
                  <tr>
                    <td height="37"><label>记账标志：</label>
                      <select name="select3" class="easyui-combobox" style="width:170px" panelheight="auto">
                        <option value="0">本期</option>
                        <option value="1">黄钻</option>
                        <option value="2">红钻</option>
                        <option value="3">蓝钻</option>
                    </select></td>
                    <td>
                      <label>红蓝标志：</label>
                      <select name="select4" class="easyui-combobox" style="width:170px" panelheight="auto">
                        <option value="0">本期</option>
                        <option value="1">黄钻</option>
                        <option value="2">红钻</option>
                        <option value="3">蓝钻</option>
                    </select></td>
                  </tr>
                </table>

            </div>
            

          </div>
          <div title="排序">
            No contact data.
          </div>
          <div title="表格设置">
            No contact data.
          </div>
        </div>


      </div>
      
      <div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
        <a class="easyui-linkbutton" id="okbtn" data-options="iconCls:'icon-ok'" data-link="temp/storagebook.html"  href="javascript:void(0)" iframe="0" style="width:80px">Ok</a>
        <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)" onclick="javascript:alert('cancel')" style="width:80px">Cancel</a>
      </div>

    </div>
<!--</div> -->


<!-- 出库新增 -->
<div id="wu-mater" class="easyui-window" title="出库新增" data-options="iconCls:'icon-save',closed:'true'" style="width:700px;padding:10px;">
    <form id="wumaters" method="post">
      <table>
        <tr height="35">
          <td width="70" align="right">出库:</td>
          <td><a href="#" class="easyui-linkbutton"
              data-options="iconCls:'icon-add'" onclick="addmateral('materTable','materFood','materProc','mainWeight',0)">增加出库商品</a></td>
        </tr>
        <tr height="35">
          <td align="right">&nbsp;</td>
          <td>
          <table id="materTable">
            <tr>
              <td>
          <select id="materProc" name="materFood[0].materProc"
            class="easyui-combobox" style="width: 200px"
            data-options="required:true,editable:false"></select>
          </td>
          <td>
            <label>数量：</label><input id="matermuch" name="materFood[0].mainWeight" class="easyui-numberbox" data-options="required:true">
            &nbsp;<span class="kmuch" style="display:none;">当前库存数:<label class="kcs" >155</label></span>
          </td>
            </tr>
          </table>
          </td>
        </tr>
        <tr>
          <td>
            
          </td>
                
        </tr>
        <tr>
          <td>
            
          </td>
                
        </tr>
      </table>
    </form>
</div>

<!-- 选单号 -->
<div id="wu-choosemater" class="easyui-window" title="选单号" data-options="iconCls:'icon-save',closed:'true'" style="width:auto;padding:10px;">
    <form action="" id="wumaterchoose" method="post">
        <p>库存数量：<input type="text" class="easyui-numberbox"  style="width:200px;" data-options="required:true,validType:'numberbox',missingMessage:'只能填数字'"></p>
        <p>商品名称：<input type="text" class="easyui-textbox" style="width:200px;" ></p>
        <p>商品代码：<input type="text" class="easyui-numberbox" style="width:200px;" ></p>
    </form>
</div>

<!-- 库存查询 -->

<div id="wu-checkmater" class="easyui-window" title="库存查询" data-options="iconCls:'icon-save',closed:'true',modal:true" style="width:auto;height:500px;padding:10px;">
    <table id="checkmater" class="easyui-datagrid" data-options="method:'get'" >  
    </table> 
</div>
<!-- 出库审核 -->
<div id="wu-checkmat" class="easyui-window" title="出库审核" data-options="iconCls:'icon-save',closed:'true',modal:true" style="width:auto;padding:10px;">
    <form id="checkmaters" method="post">
      库存数量: <input class="easyui-textbox" style="width:200px;height:32px" disabled="disabled" name="status">
    </form>
</div>



<script type="text/javascript">
    // 库存查询
       
        $('#checkmater').datagrid({
            url:'temp/maingrid.json',
            // singleSelect:true,
            fitColumns:true,
            singleSelect:true,
            pageSize : 10,
            pagePosition : 'bottom',
            // pageList:[10,20,30,40],    
            pagination : true,
            fit : true,
            columns:[[
              { field:'unitcost',title:'商品代码',width:100},
              { field:'listprice',title:'商品名称',width:100},
              { field:'status',title:'数量',width:100},     
            ]],
            
             // onClickRow : function(rowIndex){
             //   //你要写的逻辑
             //   $('#w').window('open');

             //  }
        });

    

    // 选单号信息
    $("#choosemater").combobox({
      onSelect:function(){
        $('#wu-choosemater').dialog({
          closed : false,
          modal : true,
          title : "选单号",
          buttons : [ {
            text : '确定',
            iconCls : 'icon-ok',
            handler : addProduct
          }, {
            text : '取消',
            iconCls : 'icon-cancel',
            handler : function() {
              $('#wu-choosemater').dialog('close');
            }
          } ]
        });
      }
    })



    // $.extend($.fn.validatebox.defaults.rules, {
    //     minLength: {
    //     validator: function(value, param){
    //       return value.length >= param[0];
    //     },
    //     message: 'Please enter at least {0} characters.'
    //     }
    // });



    function addProduct() {
      $('#wumaters').form('submit', {
          url : '',
          onSubmit: function(){
          // do some check
          // return false to prevent submit;
          //var truemuch = $('#matermuch').val();
            var truemuch = parseInt($('.kcs').text());

            //console.log(truemuch);
            if($('#matermuch').val()>truemuch){
              $.messager.alert('信息提示', '超出当前库存数量', 'info');
              $('#wumaters').form('clear');
               return false
            }

          },
          success : function(data) {
            if (data) {
              $.messager.alert('信息提示', '提交成功！', 'info');
              $('#wu-mater').dialog('close');
            } else {
              $.messager.alert('信息提示', '提交失败！', 'info');
            }
          }
        });
      }

    // $('#upmater').combobox({
    //   onChange: function(){
    //     alert();
    //   }
    // });

    // 新增出库
      function addmateral(obj,food,mainName,weight,flag){
          var index=0;
          if(flag==0){
            index=++mainCount;
          }else{
            index=++assistCount;
          }
          var tr=$("<tr class='clear'></tr>");
          var td1=$("<td></td>");
          var td2=$("<td></td>");
          var td3=$("<td></td>");
          var select=$("<select></select>");
          select.css("width","200px");
          select.attr("name",food+"["+index+"]."+mainName);
          var label=$("<lalbel></label>");
          label.text("分量：");
          var input=$("<input>");
          input.attr("name",food+"["+index+"]."+weight);
          var delBtn=$("<a></a>");
          td1.append(select);
          td2.append(label);
          td2.append(input);
          td3.append(delBtn);
          tr.append(td1);
          tr.append(td2);
          tr.append(td3);
          $("#"+obj).append(tr);
          select.combobox({
            method:'get',
            url:'temp/goods.json',
            valueField : 'id',
            textField : 'text',
            editable:false,
            required:true
          });
          input.numberbox({
            required:true
          });
          delBtn.linkbutton({
            iconCls:'icon-cancel'
          });
          delBtn.click(function(){
            tr.remove();
          });
      }

      function materopenAdd() {
         mainCount=0;
         assistCount=0;
         $('.kmuch').hide();
        $("#materProc").combobox({
          method : 'get',
          url : 'temp/goods.json',
          valueField : 'id',
          textField : 'text',
          onSelect:function(){
            $('.kmuch').show();
          }
        });
        // $("#assistProc").combobox({
        //   method : 'get',
        //   url : 'temp/goods.json',
        //   valueField : 'id',
        //   textField : 'text',
        // });

        // $('#matermuch').validatebox({
        //     required: true,
        //     validType: 'email'
        // });
       
        $("#wumaters").form("clear");
        $(".clear").remove();
        $('#wu-mater').dialog({
          closed : false,
          modal : true,
          title : "出库新增",
          resizable: true,
          buttons : [ {
            text : '确定',
            iconCls : 'icon-ok',
            handler : addProduct
          }, {
            text : '取消',
            iconCls : 'icon-cancel',
            handler : function() {
              $('#wu-mater').dialog('close');
            }
          } ]
        });
      }

   //   function materopenAdd() {
   //      $('#wumaters').form('clear');
        


   //      $('#wu-mater').dialog({
   //        closed : false,
   //        modal : true,
   //        title : "出库新增",
   //        buttons : [ {
   //          text : '确定',
   //          iconCls : 'icon-ok',
   //          handler : addProduct
   //        }, {
   //          text : '取消',
   //          iconCls : 'icon-cancel',
   //          handler : function() {
   //            $('#wu-mater').dialog('close');
   //          }
   //        } ]
   //      });
   // }

    
    


    // 出库审核
    function materopenEdit() {
    var row = $('#ll').datagrid('getSelected');
    if (row) {
      $('#checkmaters').form('clear');
      
      $('#checkmaters').form('load', {
        // timeup : row.productid,
        // productname : row.productname,
        // shopname : row.shopname,
        status : row.status,
        // phone : row.phone,
        // much : row.much,
        // onlne :row.onlne,
        // allmuch :row.allmuch
      });

      $('#wu-checkmat').dialog({
        closed : false,
        modal : true,
        title : "修改商品",
        buttons : [ {
          text : '确定',
          iconCls : 'icon-ok',
          handler : addProduct
        }, {
          text : '取消',
          iconCls : 'icon-cancel',
          handler : function() {
            $('#wu-checkmat').dialog('close');
          }
        } ]
      });
    } else {
      $.messager.alert('信息提示', '请选择商品！', 'info');
    }
   }


    $(function(){
      $('#okbtn').bind("click",function(){
        var title = "采购入库时序簿";
        var url = $(this).attr('data-link');
        var iconCls = $(this).attr('data-icon');
        var iframe = $(this).attr('iframe')==1?true:false;
        addTab(title,url,iconCls,iframe);
        $('.window,.window-shadow,.window-mask').hide();
      }); 


        // 日历禁止
        var d = new Date();
        var str = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
        $('#lil').attr('value',str);
    })




    /**
    * Name 添加菜单选项
    * Param title 名称
    * Param href 链接
    * Param iconCls 图标样式
    * Param iframe 链接跳转方式（true为iframe，false为href）
    */  
    function addTab(title, href, iconCls, iframe){
      var tabPanel = $('#wu-tabs');
      if(!tabPanel.tabs('exists',title)){
        var content = '<iframe scrolling="auto" frameborder="0"  src="'+ href +'" style="width:100%;height:100%;"></iframe>';
        if(iframe){
          tabPanel.tabs('add',{
            title:title,
            content:content,
            iconCls:iconCls,
            fit:true,
            cls:'pd3',
            closable:true
          });
        }
        else{
          tabPanel.tabs('add',{
            title:title,
            href:href,
            iconCls:iconCls,
            fit:true,
            cls:'pd3',
            closable:true
          });
        }
      }
      else
      {
        tabPanel.tabs('select',title);
      }
    }


     $('#demo').datagrid({
              url:'temp/datagrid.json',
              singleSelect:true,
              fitColumns:true,
              rownumbers:true,
              collapsible:true,

              columns:[[
                { field:'productid',title:'猪肉',width:100,sortable:true},
                { field:'productname',title:'猪肉代码',width:180,sortable:true,editor:'text'},
                { field:'unitcost',title:'猪肉名称',width:100,editor:'text'},
                { field:'listprice',title:'猪肉型号',width:100,editor:'text'},
                { field:'status',title:'猪肉仓库',width:100,editor:'text'},
                { field:'attr1',title:'猪肉属性',width:100,editor:'text'},      
              ]]
      });

    $('#ll').datagrid({
      url:'temp/maingrid.json',
      // singleSelect:true,
      fitColumns : true,
      collapsible : true,
      fit : true,
      rownumbers : true,
      pageSize : 10,
      pagePosition : 'bottom',
      // pageList:[10,20,30,40],    
      pagination : true,

      columns:[[
        
        { field:'productid',title:'出库仓库',width:100,sortable:true},
        { field:'productname',title:'出库日期',width:180,sortable:true,editor:'text'},
        { field:'unitcost',title:'商品代码',width:100,editor:'text'},
        { field:'listprice',title:'商品名称',width:100,editor:'text'},
        { field:'status',title:'数量',width:100,editor:'text'},
        { field:'attr1',title:'备注',width:100,editor:'text'},      
      ]],
      
       // onClickRow : function(rowIndex){
       //   //你要写的逻辑
       //   $('#w').window('open');

       //  }
  });


    $('#sw').datagrid({
      url:'temp/maingrid.json',
      singleSelect:true,
      fitColumns:true,
      collapsible:true,

      columns:[[
        { field:'productid',title:'逻辑',width:100,sortable:true},
        { field:'productname',title:'名称',width:180,sortable:true,editor:'text'},
        { field:'unitcost',title:'比较关系',width:100,editor:'text'},
        { field:'listprice',title:'数值',width:100,editor:'text'},
       
      ]]
  })

   
    


</script>

